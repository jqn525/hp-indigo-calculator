<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Configure and order coil-bound, wire-o, or perfect-bound notebooks with real-time pricing">
    <meta name="theme-color" content="#CC0633">
    
    <title>Notebook Configurator | SFU Document Solutions</title>
    
    <link rel="manifest" href="../manifest.json">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/styles.css?v=135">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SFU Calc">
    
    <!-- Authentication Guard - Protects entire application -->
    <script src="../js/auth-guard.js"></script>
</head>
<body>
    <!-- Desktop Header Navigation -->
    <header class="main-header">
        <div class="header-container">
            <!-- Brand/Logo -->
            <a href="../index.html" class="header-brand">
                <div class="brand-text">SFU Document Solutions</div>
            </a>

            <!-- Header Actions -->
            <div class="header-actions">
                <!-- Search -->
                <div class="header-search">
                    <input type="text" placeholder="Search products..." />
                    <button type="submit">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                        </svg>
                    </button>
                </div>

                <!-- User Menu -->
                <div class="header-user-menu">
                    <button class="user-menu-toggle">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        Account
                    </button>
                    <div class="dropdown-menu">
                        <a href="signin.html" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M10,17V14H3V10H10V7L15,12L10,17M10,2H19A2,2 0 0,1 21,4V20A2,2 0 0,1 19,22H10A2,2 0 0,1 8,20V18H10V20H19V4H10V6H8V4A2,2 0 0,1 10,2Z"/>
                            </svg>
                            Sign In
                        </a>
                    </div>
                </div>

                <!-- Shopping Cart -->
                <div class="header-cart">
                    <a href="cart.html" class="cart-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7,18C8.1,18 9,18.9 9,20S8.1,22 7,22 5,21.1 5,20 5.9,18 7,18M1,2V4H3L6.6,11.59L5.24,14.04C5.09,14.32 5,14.65 5,15A2,2 0 0,0 7,17H19V15H7.42A0.25,0.25 0 0,1 7.17,14.75C7.17,14.7 7.18,14.66 7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5H5.21L4.27,3H1M17,18C18.1,18 19,18.9 19,20S18.1,22 17,22 15,21.1 15,20 15.9,18 17,18Z"/>
                        </svg>
                        <span class="cart-badge" style="display: none;">0</span>
                    </a>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" aria-expanded="false">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <ul class="mobile-nav-list">
            <li class="mobile-nav-item">
                <a href="small-format.html" class="mobile-nav-link">Small Format</a>
            </li>
            <li class="mobile-nav-item">
                <a href="large-format.html" class="mobile-nav-link">Large Format</a>
            </li>
            <li class="mobile-nav-item">
                <a href="promo.html" class="mobile-nav-link">Promotional</a>
            </li>
            <li class="mobile-nav-item">
                <a href="#about" class="mobile-nav-link">About</a>
            </li>
            <li class="mobile-nav-item">
                <a href="#contact" class="mobile-nav-link">Contact</a>
            </li>
            <li class="mobile-nav-item">
                <a href="cart.html" class="mobile-nav-link">Cart</a>
            </li>
            <li class="mobile-nav-item">
                <a href="signin.html" class="mobile-nav-link">Sign In</a>
            </li>
        </ul>
    </nav>

    <main>
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb-nav">
            <div class="container">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                    <li class="breadcrumb-item"><a href="small-format.html">Small Format Printing</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Notebook Configurator</li>
                </ol>
            </div>
        </nav>

        <!-- Product Configurator -->
        <div class="container">
            <div class="configurator-layout">
                <!-- Product Preview Section -->
                <div class="product-preview-section">
                    <div class="preview-header">
                        <h1>Notebooks</h1>
                        <p class="preview-subtitle">Professional notebooks with coil, wire-o, or perfect binding. Choose from 50 or 100 pages with premium paper options.</p>
                    </div>
                    
                    <div class="preview-container">
                        <!-- Configuration Summary -->
                        <div class="config-summary">
                            <h4>Your Configuration</h4>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <span class="summary-label">Size:</span>
                                    <span class="summary-value" id="summarySize">5.5" Ã— 8.5"</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Pages:</span>
                                    <span class="summary-value" id="summaryPages">50 pages</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Binding:</span>
                                    <span class="summary-value" id="summaryBinding">Plastic Coil</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Cover:</span>
                                    <span class="summary-value" id="summaryCover">100# Cover Uncoated</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Interior:</span>
                                    <span class="summary-value" id="summaryInterior">60# Text Uncoated</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Content:</span>
                                    <span class="summary-value" id="summaryContent">Lined</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Turnaround:</span>
                                    <span class="summary-value" id="summaryTurnaround">Standard (3-5 days)</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Quantity:</span>
                                    <span class="summary-value" id="summaryQuantity">10 pieces</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Live Pricing Display -->
                        <div class="live-pricing">
                            <div class="price-summary">
                                <div class="unit-price">
                                    <span class="price-label">Per unit:</span>
                                    <span class="price-value" id="liveUnitPrice">$0.00</span>
                                </div>
                                <div class="current-price">
                                    <span class="price-label">Total Price</span>
                                    <span class="price-value" id="livePrice">$0.00</span>
                                </div>
                            </div>
                            <div class="price-status" id="priceStatus">
                                <span class="status-text">Configure your product to see pricing</span>
                            </div>
                            
                            <!-- Collapsible Price Breakdown Inside Red Cell -->
                            <button class="price-breakdown-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#redCellBreakdown" aria-expanded="false" aria-controls="redCellBreakdown">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7,10L12,15L17,10H7Z"/>
                                </svg>
                                VIEW PRICE BREAKDOWN
                            </button>
                            
                            <div class="collapse mt-2" id="redCellBreakdown">
                                <div class="red-cell-breakdown">
                                    <div class="breakdown-row">
                                        <span>Template Setup:</span>
                                        <span id="redSetupCost">$0.00</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Finishing Setup:</span>
                                        <span id="redFinishingSetupCost">$15.00</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Production:</span>
                                        <span id="redProductionCost">$0.00</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Materials:</span>
                                        <span id="redMaterialCost">$0.00</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Labor:</span>
                                        <span id="redLaborCost">$0.00</span>
                                    </div>
                                    <div class="breakdown-row">
                                        <span>Binding:</span>
                                        <span id="redBindingCost">$0.00</span>
                                    </div>
                                    <div class="breakdown-row subtotal">
                                        <span>Subtotal:</span>
                                        <span id="redSubtotal">$0.00</span>
                                    </div>
                                    <div class="breakdown-row" id="redRushMultiplierItem" style="display: none;">
                                        <span>Rush:</span>
                                        <span id="redRushMultiplier">1x</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add to Cart Button (Separate) -->
                        <button type="button" class="btn btn-add-to-cart" id="addToCartBtn" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7,18C8.1,18 9,18.9 9,20S8.1,22 7,22 5,21.1 5,20 5.9,18 7,18M1,2V4H3L6.6,11.59L5.24,14.04C5.09,14.32 5,14.65 5,15A2,2 0 0,0 7,17H19V15H7.42A0.25,0.25 0 0,1 7.17,14.75C7.17,14.7 7.18,14.66 7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5H5.21L4.27,3H1M17,18C18.1,18 19,18.9 19,20S18.1,22 17,22 15,21.1 15,20 15.9,18 17,18Z"/>
                            </svg>
                            Add to Cart
                        </button>
                    </div>
                </div>

                <!-- Configuration Panel -->
                <div class="configuration-panel">
                    <form id="notebookForm" class="configurator-form">
                        <!-- Size Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Size</h3>
                            </div>
                            <div class="option-grid">
                                <label class="option-card selected" data-option="size" data-value="5.5x8.5">
                                    <input type="radio" name="size" value="5.5x8.5" checked hidden>
                                    <div class="option-content">
                                        <div class="option-title">5.5" Ã— 8.5"</div>
                                        <div class="option-subtitle">Compact Size</div>
                                        <div class="option-badge recommended">Recommended</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="size" data-value="8.5x11">
                                    <input type="radio" name="size" value="8.5x11" hidden>
                                    <div class="option-content">
                                        <div class="option-title">8.5" Ã— 11"</div>
                                        <div class="option-subtitle">Standard Size</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Pages Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Pages</h3>
                            </div>
                            <div class="option-grid">
                                <label class="option-card selected" data-option="pages" data-value="50">
                                    <input type="radio" name="pages" value="50" checked hidden>
                                    <div class="option-content">
                                        <div class="option-title">50 Pages</div>
                                        <div class="option-subtitle">25 Sheets</div>
                                        <div class="option-badge recommended">Popular</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="pages" data-value="100">
                                    <input type="radio" name="pages" value="100" hidden>
                                    <div class="option-content">
                                        <div class="option-title">100 Pages</div>
                                        <div class="option-subtitle">50 Sheets</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Binding Type Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Binding Type</h3>
                            </div>
                            <div class="option-grid">
                                <label class="option-card selected" data-option="binding" data-value="plasticCoil">
                                    <input type="radio" name="bindingType" value="plasticCoil" checked hidden>
                                    <div class="option-content">
                                        <div class="option-title">Plastic Coil</div>
                                        <div class="option-subtitle">Durable, lies flat</div>
                                        <div class="option-badge recommended">Standard</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="binding" data-value="wireO">
                                    <input type="radio" name="bindingType" value="wireO" hidden>
                                    <div class="option-content">
                                        <div class="option-title">Wire-O</div>
                                        <div class="option-subtitle">Premium look</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="binding" data-value="perfectBinding">
                                    <input type="radio" name="bindingType" value="perfectBinding" hidden>
                                    <div class="option-content">
                                        <div class="option-title">Perfect Binding</div>
                                        <div class="option-subtitle">Book-like spine</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Page Content Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Page Content</h3>
                            </div>
                            <div class="option-grid">
                                <label class="option-card selected" data-option="content" data-value="lined">
                                    <input type="radio" name="pageContent" value="lined" checked hidden>
                                    <div class="option-content">
                                        <div class="option-title">Lined</div>
                                        <div class="option-subtitle">Standard ruled lines</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="content" data-value="blank">
                                    <input type="radio" name="pageContent" value="blank" hidden>
                                    <div class="option-content">
                                        <div class="option-title">Blank</div>
                                        <div class="option-subtitle">No setup discount</div>
                                        <div class="option-badge recommended">Save $15</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Cover Paper Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Cover Paper</h3>
                            </div>
                            <div class="option-grid">
                                <label class="option-card selected" data-option="coverPaper" data-value="LYNOC95FSC">
                                    <input type="radio" name="coverPaper" value="LYNOC95FSC" checked hidden>
                                    <div class="option-content">
                                        <div class="option-title">100# Cover Uncoated</div>
                                        <div class="option-subtitle">Matte finish</div>
                                        <div class="option-badge recommended">Standard</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="coverPaper" data-value="PACDISC9513FSC">
                                    <input type="radio" name="coverPaper" value="PACDISC9513FSC" hidden>
                                    <div class="option-content">
                                        <div class="option-title">100# Cover Silk</div>
                                        <div class="option-subtitle">Smooth finish</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Interior Paper Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Interior Paper</h3>
                            </div>
                            <div class="option-grid">
                                <label class="option-card selected" data-option="textPaper" data-value="LYNODI312FSC">
                                    <input type="radio" name="textPaper" value="LYNODI312FSC" checked hidden>
                                    <div class="option-content">
                                        <div class="option-title">60# Text Uncoated</div>
                                        <div class="option-subtitle">Standard writing paper</div>
                                        <div class="option-badge recommended">Popular</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="textPaper" data-value="LYNO416FSC">
                                    <input type="radio" name="textPaper" value="LYNO416FSC" hidden>
                                    <div class="option-content">
                                        <div class="option-title">80# Text Uncoated</div>
                                        <div class="option-subtitle">Heavier weight paper</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Quantity Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Quantity</h3>
                            </div>
                            <div class="quantity-input-group">
                                <div class="quantity-controls">
                                    <button type="button" class="quantity-btn minus" data-action="decrease">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M19,13H5V11H19V13Z"/>
                                        </svg>
                                    </button>
                                    <input type="number" class="quantity-input" id="quantity" name="quantity" 
                                           min="10" max="500" value="10" step="1"
                                           inputmode="numeric" pattern="[0-9]*" required>
                                    <button type="button" class="quantity-btn plus" data-action="increase">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="quantity-suggestions">
                                    <button type="button" class="qty-suggestion" data-qty="25">25</button>
                                    <button type="button" class="qty-suggestion" data-qty="50">50</button>
                                    <button type="button" class="qty-suggestion" data-qty="100">100</button>
                                    <button type="button" class="qty-suggestion" data-qty="250">250</button>
                                    <button type="button" class="qty-suggestion" data-qty="500">500</button>
                                </div>
                                <div class="quantity-limits">
                                    <small>Minimum: 10 â€¢ Maximum: 500</small>
                                </div>
                            </div>
                        </div>

                        <!-- Turnaround Configuration -->
                        <div class="config-section">
                            <div class="section-header">
                                <h3>Turnaround Time</h3>
                            </div>
                            <div class="option-grid">
                                <label class="option-card selected" data-option="rush" data-value="standard">
                                    <input type="radio" name="rushType" value="standard" checked hidden>
                                    <div class="option-content">
                                        <div class="option-title">Standard</div>
                                        <div class="option-subtitle">3-5 business days</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="rush" data-value="2-day">
                                    <input type="radio" name="rushType" value="2-day" hidden>
                                    <div class="option-content">
                                        <div class="option-title">2-Day Rush</div>
                                        <div class="option-subtitle">+25% fee</div>
                                    </div>
                                </label>
                                <label class="option-card" data-option="rush" data-value="next-day">
                                    <input type="radio" name="rushType" value="next-day" hidden>
                                    <div class="option-content">
                                        <div class="option-title">Next-Day Rush</div>
                                        <div class="option-subtitle">+50% fee</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Core JavaScript -->
    <script src="../js/paperStocks.js"></script>
    <script src="../js/pricingConfig.js"></script>
    <script src="../js/impositionCalculator.js"></script>
    <script src="../js/calculator.js"></script>
    <script src="../js/cart.js"></script>
    <script src="../js/header.js"></script>
    
    <!-- Authentication (Supabase) -->
    <script src="../js/supabase.js"></script>
    <script src="../js/auth.js"></script>

    <script>
        // Global variables
        let currentFormData = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            // Set up event listeners for option cards
            const optionCards = document.querySelectorAll('.option-card');
            optionCards.forEach(card => {
                card.addEventListener('click', handleOptionCardClick);
            });

            // Set up quantity input listener
            const quantityInput = document.querySelector('input[name="quantity"]');
            if (quantityInput) {
                quantityInput.addEventListener('input', handleInputChange);
            }

            // Set up quantity preset buttons
            const qtyButtons = document.querySelectorAll('.qty-suggestion');
            qtyButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const qty = parseInt(this.dataset.qty);
                    updateQuantity(qty);
                });
            });

            // Set up quantity +/- controls
            const plusBtn = document.querySelector('.quantity-btn.plus');
            const minusBtn = document.querySelector('.quantity-btn.minus');
            
            if (plusBtn) {
                plusBtn.addEventListener('click', function() {
                    const currentQty = parseInt(quantityInput.value) || 10;
                    const newQty = Math.min(currentQty + 25, 500);
                    updateQuantity(newQty);
                });
            }
            
            if (minusBtn) {
                minusBtn.addEventListener('click', function() {
                    const currentQty = parseInt(quantityInput.value) || 10;
                    const newQty = Math.max(currentQty - 25, 10);
                    updateQuantity(newQty);
                });
            }

            // Initial calculation
            handleInputChange();
        }

        function handleOptionCardClick(event) {
            const clickedCard = event.currentTarget;
            const optionType = clickedCard.dataset.option;
            const value = clickedCard.dataset.value;

            // Remove selected class from all cards of this option type
            const allCardsOfType = document.querySelectorAll(`[data-option="${optionType}"]`);
            allCardsOfType.forEach(card => card.classList.remove('selected'));

            // Add selected class to clicked card
            clickedCard.classList.add('selected');

            // Update the hidden radio button
            const radioButton = clickedCard.querySelector('input[type="radio"]');
            if (radioButton) {
                radioButton.checked = true;
            }

            // Update summary
            updateSummary();

            // Trigger calculation
            handleInputChange();
        }

        function updateQuantity(quantity) {
            const quantityInput = document.querySelector('input[name="quantity"]');
            if (quantityInput) {
                quantityInput.value = quantity;
                
                // Update preset button active states
                const qtyButtons = document.querySelectorAll('.qty-suggestion');
                qtyButtons.forEach(btn => {
                    const btnQty = parseInt(btn.dataset.qty);
                    if (btnQty === quantity) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Trigger calculation
                handleInputChange();
            }
        }

        function handleInputChange() {
            const form = document.getElementById('notebookForm');
            if (!form) return;

            const formData = new FormData(form);
            currentFormData = formData;

            // Update summary
            updateSummary();

            // Calculate pricing
            calculatePrice();
        }

        function updateSummary() {
            if (!currentFormData) return;

            // Update size
            const size = currentFormData.get('size');
            if (size) {
                const sizeDisplay = size === '5.5x8.5' ? '5.5" Ã— 8.5"' : '8.5" Ã— 11"';
                document.getElementById('summarySize').textContent = sizeDisplay;
            }

            // Update pages
            const pages = currentFormData.get('pages');
            if (pages) {
                document.getElementById('summaryPages').textContent = `${pages} pages`;
            }

            // Update binding
            const binding = currentFormData.get('bindingType');
            if (binding) {
                const bindingDisplay = {
                    'plasticCoil': 'Plastic Coil',
                    'wireO': 'Wire-O',
                    'perfectBinding': 'Perfect Binding'
                };
                document.getElementById('summaryBinding').textContent = bindingDisplay[binding] || binding;
            }

            // Update content
            const content = currentFormData.get('pageContent');
            if (content) {
                const contentDisplay = {
                    'lined': 'Lined',
                    'blank': 'Blank'
                };
                document.getElementById('summaryContent').textContent = contentDisplay[content] || content;
            }

            // Update papers
            const coverPaper = currentFormData.get('coverPaper');
            const textPaper = currentFormData.get('textPaper');
            
            // Map paper codes to display names
            const paperMap = {
                'LYNOC95FSC': '100# Cover Uncoated',
                'PACDISC9513FSC': '100# Cover Silk',
                'LYNODI312FSC': '60# Text Uncoated',
                'LYNO416FSC': '80# Text Uncoated'
            };
            
            if (coverPaper) {
                document.getElementById('summaryCover').textContent = paperMap[coverPaper] || coverPaper;
            }
            if (textPaper) {
                document.getElementById('summaryInterior').textContent = paperMap[textPaper] || textPaper;
            }

            // Update quantity
            const quantity = currentFormData.get('quantity');
            if (quantity) {
                document.getElementById('summaryQuantity').textContent = `${quantity} pieces`;
            }

            // Update turnaround
            const rush = currentFormData.get('rushType');
            if (rush) {
                const rushDisplay = {
                    'standard': 'Standard (3-5 days)',
                    '2-day': '2-Day Rush',
                    'next-day': 'Next-Day Rush'
                };
                document.getElementById('summaryTurnaround').textContent = rushDisplay[rush] || rush;
            }
        }

        async function calculatePrice() {
            if (!currentFormData || typeof calculateNotebookPrice !== 'function') {
                return;
            }

            try {
                const pricing = await calculateNotebookPrice(currentFormData);
                
                if (pricing && !pricing.error) {
                    // Update live pricing
                    document.getElementById('liveUnitPrice').textContent = `$${pricing.unitPrice}`;
                    document.getElementById('livePrice').textContent = `$${pricing.totalCost}`;
                    
                    // Update price status
                    document.getElementById('priceStatus').innerHTML = '<span class="status-text price-updated">Price updated</span>';
                    
                    // Update breakdown
                    document.getElementById('redSetupCost').textContent = `$${pricing.printingSetupCost}`;
                    document.getElementById('redFinishingSetupCost').textContent = `$${pricing.finishingSetupCost}`;
                    document.getElementById('redProductionCost').textContent = `$${pricing.productionCost}`;
                    document.getElementById('redMaterialCost').textContent = `$${pricing.materialCost}`;
                    document.getElementById('redLaborCost').textContent = `$${pricing.laborCost}`;
                    document.getElementById('redBindingCost').textContent = `$${pricing.bindingCost}`;
                    document.getElementById('redSubtotal').textContent = `$${pricing.subtotal}`;
                    
                    // Show/hide rush multiplier
                    const rushMultiplier = pricing.rushMultiplier || 1;
                    const rushItem = document.getElementById('redRushMultiplierItem');
                    if (rushMultiplier > 1) {
                        document.getElementById('redRushMultiplier').textContent = `${rushMultiplier}x`;
                        rushItem.style.display = 'flex';
                    } else {
                        rushItem.style.display = 'none';
                    }
                    
                    // Enable add to cart
                    const addToCartBtn = document.getElementById('addToCartBtn');
                    addToCartBtn.disabled = false;
                    addToCartBtn.onclick = function() {
                        addToCart(pricing);
                    };
                    
                } else {
                    console.error('Pricing calculation error:', pricing.error);
                    // Show error state
                    document.getElementById('priceStatus').innerHTML = '<span class="status-text">Error calculating price</span>';
                }
                
            } catch (error) {
                console.error('Calculation error:', error);
                document.getElementById('priceStatus').innerHTML = '<span class="status-text">Error calculating price</span>';
            }
        }

        function addToCart(pricing) {
            if (!pricing || typeof window.addToCart !== 'function') return;

            const cartItem = {
                product: 'Notebook',
                size: pricing.size,
                pages: pricing.pages,
                bindingType: pricing.bindingType,
                coverPaper: pricing.coverPaper,
                textPaper: pricing.textPaper,
                pageContent: pricing.pageContent,
                rushType: currentFormData.get('rushType'),
                quantity: parseInt(pricing.quantity),
                unitPrice: parseFloat(pricing.unitPrice),
                totalPrice: parseFloat(pricing.totalCost),
                timestamp: new Date().toISOString()
            };

            window.addToCart(cartItem);
            
            // Show success feedback
            const btn = document.getElementById('addToCartBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/></svg> Added to Cart!';
            btn.classList.add('btn-success');
            btn.classList.remove('btn-add-to-cart');
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('btn-success');
                btn.classList.add('btn-add-to-cart');
            }, 2000);
        }
    </script>
</body>
</html>